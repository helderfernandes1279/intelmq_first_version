from intelmq.lib.bot import Bot, sys
from intelmq.bots.collectors.url.lib import fetch_url

class RTCollectorBot(Bot): 
    
    rtuser = self.parameters.rtusername #'hfernandes' 
    rtpassword = self.parameters.rtpassword #'!sohhbvq#' #parametro
    rt_url = self.parameters.rt_url #'http://mw02.cert.rcts.pt/rt-oper/' #parametro
    subject_filter=self.parameters.subject #'Alert - Medium - [TT' #parametro 
    current_id=open('./currentid','r').read()
    from_id=107225 #parametro

    def process(self):
	default_user = 'hfernandes' #parametro
	default_password = '!sohhbvq#' #parametro
        rt_url = 'http://mw02.cert.rcts.pt/rt-oper/' #parametro
        subject_filter='Alert - Medium - [TT' #parametro
        from_id=107225 #parametro
        self.logger.info("Downloading report from %s" % self.parameters.url)
        report = fetch_url(self.parameters.url, timeout = 60.0, chunk_size = 16384, http_proxy=self.parameters.http_proxy, https_proxy=self.parameters.https_proxy)
        self.logger.info("Report downloaded.")
        self.send_message(report)


if __name__ == "__main__":
    bot = RTCollectorBot(sys.argv[1])
    bot.start()
